qiaoyk@gwserver-ThinkCentre-M720t-N000:~/qmi_wwan/driver$ ls
Makefile  qmi_wwan.c  test.log
qiaoyk@gwserver-ThinkCentre-M720t-N000:~/qmi_wwan/driver$ make
make -C /lib/modules/4.4.0-148-generic/build M=/mnt/work/qiaoyk/qmi_wwan/driver modules
make[1]: Entering directory `/usr/src/linux-headers-4.4.0-148-generic'
make[2]: *** No rule to make target `/mnt/work/qiaoyk/qmi_wwan/driver/qmi_wwan_bm.c', needed by `/mnt/work/qiaoyk/qmi_wwan/driver/qmi_wwan_bm.o'.  Stop.
make[1]: *** [_module_/mnt/work/qiaoyk/qmi_wwan/driver] Error 2
make[1]: Leaving directory `/usr/src/linux-headers-4.4.0-148-generic'
make: *** [all] Error 2
qiaoyk@gwserver-ThinkCentre-M720t-N000:~/qmi_wwan/driver$ vim make clean; make
2 files to edit
make -C /lib/modules/4.4.0-148-generic/build M=/mnt/work/qiaoyk/qmi_wwan/driver modules
make[1]: Entering directory `/usr/src/linux-headers-4.4.0-148-generic'
  CC [M]  /mnt/work/qiaoyk/qmi_wwan/driver/qmi_wwan.o
  Building modules, stage 2.
  MODPOST 1 modules
  CC      /mnt/work/qiaoyk/qmi_wwan/driver/qmi_wwan.mod.o
  LD [M]  /mnt/work/qiaoyk/qmi_wwan/driver/qmi_wwan.ko
make[1]: Leaving directory `/usr/src/linux-headers-4.4.0-148-generic'
qiaoyk@gwserver-ThinkCentre-M720t-N000:~/qmi_wwan/driver$ ls
Makefile  modules.order  Module.symvers  qmi_wwan.c  qmi_wwan.ko  qmi_wwan.mod.c  qmi_wwan.mod.o  qmi_wwan.o  test.log
qiaoyk@gwserver-ThinkCentre-M720t-N000:~/qmi_wwan/driver$ sudo modprobe usbnet
[sudo] password for qiaoyk:
qiaoyk@gwserver-ThinkCentre-M720t-N000:~/qmi_wwan/driver$ sudo modprobe cdc-wdm
qiaoyk@gwserver-ThinkCentre-M720t-N000:~/qmi_wwan/driver$ sudo insmod ./qmi_wwan.ko
qiaoyk@gwserver-ThinkCentre-M720t-N000:~/qmi_wwan/driver$ ifconfig -a
edge0     Link encap:Ethernet  HWaddr fa:2c:e3:75:84:24
          inet addr:192.168.99.1  Bcast:192.168.99.255  Mask:255.255.255.0
          inet6 addr: fe80::f82c:e3ff:fe75:8424/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1290  Metric:1
          RX packets:18165 errors:0 dropped:0 overruns:0 frame:0
          TX packets:41015 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:1538098 (1.5 MB)  TX bytes:8177681 (8.1 MB)

edge1     Link encap:Ethernet  HWaddr d2:4a:e9:7c:90:1c
          inet addr:192.168.90.1  Bcast:192.168.90.255  Mask:255.255.255.0
          inet6 addr: fe80::d04a:e9ff:fe7c:901c/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1290  Metric:1
          RX packets:20 errors:0 dropped:0 overruns:0 frame:0
          TX packets:163 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:2004 (2.0 KB)  TX bytes:31192 (31.1 KB)

eth0      Link encap:Ethernet  HWaddr 6c:4b:90:d0:b4:15
          inet addr:10.99.100.231  Bcast:10.99.100.255  Mask:255.255.255.0
          inet6 addr: fe80::6e4b:90ff:fed0:b415/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:15647760 errors:0 dropped:0 overruns:0 frame:0
          TX packets:13097654 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:1674991003 (1.6 GB)  TX bytes:15688641396 (15.6 GB)

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:270239 errors:0 dropped:0 overruns:0 frame:0
          TX packets:270239 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1
          RX bytes:17295798 (17.2 MB)  TX bytes:17295798 (17.2 MB)

wwan0     Link encap:Ethernet  HWaddr 52:e2:46:8f:45:4d
          BROADCAST NOARP MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

qiaoyk@gwserver-ThinkCentre-M720t-N000:~/qmi_wwan/driver$ sudo apt-cache search qmi
libqmi-glib-dev - Header files for adding QMI support to applications that use glib
libqmi-glib-doc - API documentation for libqmi-glib
libqmi-glib0 - Support library to use the Qualcomm MSM Interface (QMI) protocol
libqmi-glib0-dbg - Support library to use the Qualcomm MSM Interface (QMI) protocol
libqmi-utils - Utilities to use the QMI protocol from the command line
qmidiarp - MIDI arpeggiator for ALSA
qmidiarp-dbg - Debugging symbols for QMidiArp
qmidinet - MIDI Network Gateway via UDP/IP Multicast
qmidinet-dbg - Debugging symbols for QmidiNet
qmidiroute - a MIDI event router and filter
libqmi-glib1 - Support library to use the Qualcomm MSM Interface (QMI) protocol
libqmi-glib1-dbg - Support library to use the Qualcomm MSM Interface (QMI) protocol
libqmi-proxy - Proxy to communicate with QMI ports
qiaoyk@gwserver-ThinkCentre-M720t-N000:~/qmi_wwan/driver$ sudo apt-get install libqmi-utils
Reading package lists... Done
Building dependency tree
Reading state information... Done
libqmi-utils is already the newest version.
0 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
qiaoyk@gwserver-ThinkCentre-M720t-N000:~/qmi_wwan/driver$ qmi-network /dev/cdc-wdm0 start
Starting network with 'qmicli -d /dev/cdc-wdm0 --wds-start-network=  --client-no-release-cid'...
error: couldn't open the QmiDevice: Cannot open QMI device: Cannot open device file '/dev/cdc-wdm0': Permission denied
error: network start failed, client not allocated
qiaoyk@gwserver-ThinkCentre-M720t-N000:~/qmi_wwan/driver$ sudo qmi-network /dev/cdc-wdm0 start
Starting network with 'qmicli -d /dev/cdc-wdm0 --wds-start-network=  --client-no-release-cid'...
Saving state... (CID: 19)
Saving state... (PDH: 2033441216)
Network started successfully
qiaoyk@gwserver-ThinkCentre-M720t-N000:~/qmi_wwan/driver$ sudo apt-get install udhcpc
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following NEW packages will be installed:
  udhcpc
0 upgraded, 1 newly installed, 0 to remove and 1 not upgraded.
Need to get 2,530 B of archives.
After this operation, 72.7 kB of additional disk space will be used.
Get:1 https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ trusty-updates/main udhcpc amd64 1:1.21.0-1ubuntu1.4 [2,530 B]
Fetched 2,530 B in 3s (838 B/s)
Selecting previously unselected package udhcpc.
(Reading database ... 268994 files and directories currently installed.)
Preparing to unpack .../udhcpc_1%3a1.21.0-1ubuntu1.4_amd64.deb ...
Unpacking udhcpc (1:1.21.0-1ubuntu1.4) ...
Processing triggers for man-db (2.6.7.1-1ubuntu1) ...
Setting up udhcpc (1:1.21.0-1ubuntu1.4) ...
qiaoyk@gwserver-ThinkCentre-M720t-N000:~/qmi_wwan/driver$ sudo udhcpc -i wwan0
udhcpc (v1.21.1) started
Sending discover...
Sending select for 10.227.5.130...
Lease of 10.227.5.130 obtained, lease time 7200
/etc/udhcpc/default.script: Resetting default routes
SIOCDELRT: No such process
/etc/udhcpc/default.script: Adding DNS 211.137.130.2
/etc/udhcpc/default.script: Adding DNS 211.137.130.18
qiaoyk@gwserver-ThinkCentre-M720t-N000:~/qmi_wwan/driver$ ifconfig
eth0      Link encap:Ethernet  HWaddr 6c:4b:90:d0:b4:15
          inet addr:10.99.100.231  Bcast:10.99.100.255  Mask:255.255.255.0
          inet6 addr: fe80::6e4b:90ff:fed0:b415/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:15650208 errors:0 dropped:0 overruns:0 frame:0
          TX packets:13098618 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:1675215931 (1.6 GB)  TX bytes:15688729655 (15.6 GB)

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:270353 errors:0 dropped:0 overruns:0 frame:0
          TX packets:270353 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1
          RX bytes:17303094 (17.3 MB)  TX bytes:17303094 (17.3 MB)

wwan0     Link encap:Ethernet  HWaddr 52:e2:46:8f:45:4d
          inet addr:10.227.5.130  Bcast:10.227.5.131  Mask:255.255.255.252
          inet6 addr: fe80::50e2:46ff:fe8f:454d/64 Scope:Link
          UP BROADCAST RUNNING NOARP MULTICAST  MTU:1500  Metric:1
          RX packets:3 errors:0 dropped:0 overruns:0 frame:0
          TX packets:28 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:738 (738.0 B)  TX bytes:5511 (5.5 KB)

qiaoyk@gwserver-ThinkCentre-M720t-N000:~/qmi_wwan/driver$ ping 114.114.114.114 -I wwan0
PING 114.114.114.114 (114.114.114.114) from 10.227.5.130 wwan0: 56(84) bytes of data.
64 bytes from 114.114.114.114: icmp_seq=1 ttl=94 time=99.6 ms
64 bytes from 114.114.114.114: icmp_seq=2 ttl=87 time=138 ms
64 bytes from 114.114.114.114: icmp_seq=3 ttl=82 time=94.9 ms
64 bytes from 114.114.114.114: icmp_seq=4 ttl=85 time=54.6 ms

--- 114.114.114.114 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3005ms
rtt min/avg/max/mdev = 54.610/97.007/138.824/29.821 ms
